================================================================================
  DIAGRAMA VISUAL - CNC PLOTTER
  ESP32 S3 + 3x 28BYJ-48 + MPU6050
================================================================================

                              VISTA SUPERIOR CNC
                              ==================

                    ┌─────────────────────────────────┐
                    │  ┌───────────────────────────┐  │
                    │  │                           │  │
                    │  │    ÁREA DE TRABAJO       │  │
                    │  │     (80mm x 80mm)         │  │
                    │  │                           │  │
                    │  │         📄 Papel          │  │
                    │  │                           │  │
                    │  │            ✏️              │  │
                    │  │         (Lápiz)           │  │
                    │  │                           │  │
                    │  └───────────────────────────┘  │
                    │                                 │
         MOTOR Y ⚙️ │  [Eje Y - Adelante/Atrás]      │ ⚙️ MOTOR Y
                    │                                 │
                    └─────────────────────────────────┘
                              ↕️ Eje Y

                    ←──────────────────────────────────→
                              Eje X (MOTOR X)


================================================================================
  SISTEMA DE EJES
================================================================================

        ↑ Y+
        │
        │      Área de Trabajo
        │    ┌─────────────────┐
        │    │ (0,0)           │
        │    │  ●──────────────→│ X+
        │    │  │              │
        │    │  │   📄 Papel   │
        │    │  │              │
        │    │  │   ✏️ Lápiz   │
        │    │  ↓              │
        │    │  Z (arriba/abajo)│
        │    └─────────────────┘
        │
        └──────────────────────────→ X+
       (0,0) ORIGEN HOME


Movimientos:
  • Eje X: Izquierda ← → Derecha
  • Eje Y: Atrás ↓ ↑ Adelante  
  • Eje Z: Arriba ↑ ↓ Abajo (lápiz)


================================================================================
  ARQUITECTURA DEL SISTEMA
================================================================================

                          ┌─────────────────┐
                          │                 │
                          │   COMPUTADORA   │
                          │   (Monitor      │
                          │    Serial)      │
                          │                 │
                          └────────┬────────┘
                                   │ USB-C
                                   │
                          ┌────────▼────────┐
                          │                 │
                          │   ESP32 S3      │
                          │   (Cerebro)     │
                          │                 │
                          └─┬───┬───┬───┬──┘
                            │   │   │   │
              ┌─────────────┘   │   │   └─────────────┐
              │   I2C           │   │                  │
              │                 │   │                  │
         ┌────▼─────┐      ┌───▼───▼───┐         ┌───▼───┐
         │ MPU6050  │      │ Motor X   │         │ Motor │
         │  (IMU)   │      │ + ULN2003 │         │   Y   │
         │  📡      │      │    ⚙️     │         │  ⚙️   │
         └──────────┘      └───────────┘         └───────┘
                                                       
                                ┌───────────┐
                                │  Motor Z  │
                                │ (Lápiz)   │
                                │  ⚙️ + 📡  │
                                │ + MPU6050 │
                                └─────┬─────┘
                                      │
                                      ▼
                                    ✏️ Lápiz


================================================================================
  CONEXIÓN ELÉCTRICA DETALLADA
================================================================================

ESP32 S3 PINOUT USADO:
─────────────────────

                           ┌──────────┐
                        EN │●        ●│ GPIO 21 ──→ Motor Z IN1
                     GPIO0 │●        ●│ GPIO 47 ──→ Motor Z IN2
                     GPIO1 │●        ●│ GPIO 48 ──→ Motor Z IN3
                     GPIO2 │●        ●│ GPIO 45 ──→ Motor Z IN4
                     GPIO3 │●        ●│ GPIO 46
                     GPIO4 │●        ●│ GPIO 38
                     GPIO5 │●        ●│ GPIO 37
                     GPIO6 │●        ●│ GPIO 36
                     GPIO7 │●        ●│ GPIO 35
      MPU SDA ←── GPIO 8  │●        ●│ GPIO 0
                  GPIO 9  │●        ●│ GPIO 39
      MPU SCL ←── GPIO10  │●        ●│ GPIO 40
                  GPIO11  │●        ●│ GPIO 41
      Motor X ──→ GPIO 12 │●        ●│ GPIO 42
       IN1        GPIO 13 │●        ●│ GPIO 43
                  GPIO 14 │●        ●│ GPIO 44
                  GPIO 15 │●        ●│ GND
      Motor Y ──→ GPIO 16 │●        ●│ 3V3
       IN1        GPIO 17 │●        ●│ 5V
                  GPIO 18 │●        ●│ USB_D-
                  GPIO 19 │●        ●│ USB_D+
                           └──────────┘

MOTOR X (GPIO 12-15) → ULN2003 #1 → 28BYJ-48 #1
MOTOR Y (GPIO 16-19) → ULN2003 #2 → 28BYJ-48 #2  
MOTOR Z (GPIO 21,47,48,45) → ULN2003 #3 → 28BYJ-48 #3


================================================================================
  MOTOR 28BYJ-48 INTERNO
================================================================================

         ┌───────────────────────────┐
         │                           │
         │   Motor 28BYJ-48          │
         │                           │
         │    ┌─────────────┐        │
         │    │   ⚙️ Bobinas │        │
         │    │   (4 fases)  │        │
         │    └──────┬───────┘        │
         │           │                │
         │      ┌────▼─────┐          │
         │      │  Engranajes │       │
         │      │  Ratio 64:1 │       │
         │      └────┬─────┘          │
         │           │                │
         │      ┌────▼─────┐          │
         │      │   Eje    │          │
         │      │  Salida  │          │
         │      └──────────┘          │
         └───────────────────────────┘
              ║ ║ ║ ║ ║
              ║ ║ ║ ║ ║ Conector 5 pines
              ▼ ▼ ▼ ▼ ▼
         [V+ 1 2 3 4 GND]

Especificaciones:
  • Voltaje: 5V DC
  • Corriente: 240mA (máx)
  • Pasos/Rev: 2048 (con reducción)
  • Ángulo/Paso: 5.625° (sin reducción)
  • Torque: ~300 gf·cm


================================================================================
  DRIVER ULN2003 ESQUEMÁTICO
================================================================================

                   ┌──────────────────┐
         ESP32     │   ULN2003        │      28BYJ-48
                   │   Darlington     │
                   │   Array          │
       GPIO ────→  IN1 ──┬────────┐   OUT1 ───→ Bobina 1 (Naranja)
                   │     └→ 🔽    │
       GPIO ────→  IN2 ──┬────────┤   OUT2 ───→ Bobina 2 (Amarillo)
                   │     └→ 🔽    │
       GPIO ────→  IN3 ──┬────────┤   OUT3 ───→ Bobina 3 (Rosa)
                   │     └→ 🔽    │
       GPIO ────→  IN4 ──┬────────┤   OUT4 ───→ Bobina 4 (Azul)
                   │     └→ 🔽    │
                   │              │   COM  ───→ 5V (Rojo)
        GND ────→  GND           GND
                   │                │
        5V  ────→  VCC              │
                   └──────────────────┘

🔽 = Transistor Darlington (amplificador)


================================================================================
  MPU6050 - ACELERÓMETRO Y GIROSCOPIO
================================================================================

                    ┌─────────────────┐
                    │    MPU6050      │
                    │                 │
                    │   ┌─────────┐   │
                    │   │  📐     │   │
                    │   │  Accel  │   │
                    │   │  3-axis │   │
                    │   └─────────┘   │
                    │                 │
                    │   ┌─────────┐   │
                    │   │  🔄     │   │
                    │   │  Gyro   │   │
                    │   │  3-axis │   │
                    │   └─────────┘   │
                    │                 │
                    │   ┌─────────┐   │
                    │   │ SCL → GPIO 10  │  ⚠️ Cambiado de 9 a 10
                    │   │ SDA → GPIO 8   │
                    │   └─────────┘   │
                    └─┬─┬─┬─┬─┬─┬───┘
                      │ │ │ │ │ │
                    VCC│ │ │ │ │GND
                       │ │ │ │
                      SCL│ │SDA
                         │ │
                        INT│XDA
                           XCL

Montaje: Junto al Motor Z (lápiz)
Función: Detectar inclinación y vibración
Uso: Corrección de trayectoria en tiempo real


================================================================================
  SECUENCIA DE PASOS - HALF STEP
================================================================================

Paso │ IN1 │ IN2 │ IN3 │ IN4 │ Visualización
─────┼─────┼─────┼─────┼─────┼───────────────
  0  │  1  │  0  │  0  │  0  │  ●○○○
  1  │  1  │  1  │  0  │  0  │  ●●○○
  2  │  0  │  1  │  0  │  0  │  ○●○○
  3  │  0  │  1  │  1  │  0  │  ○●●○
  4  │  0  │  0  │  1  │  0  │  ○○●○
  5  │  0  │  0  │  1  │  1  │  ○○●●
  6  │  0  │  0  │  0  │  1  │  ○○○●
  7  │  1  │  0  │  0  │  1  │  ●○○●

Secuencia se repite ↻

Características:
  • 8 pasos por ciclo
  • Mayor precisión que full-step
  • Movimiento más suave
  • Mayor torque en bajas velocidades


================================================================================
  FLUJO DE DATOS
================================================================================

    Monitor Serial                     ESP32 S3
    ──────────────                     ────────
         │                                │
         │ Comando: 'S'                   │
         ├───────────────────────────────→│
         │                                │
         │                                │ ┌─────────────────┐
         │                                ├→│ Parser Comando │
         │                                │ └────────┬────────┘
         │                                │          │
         │                                │          ▼
         │                                │ ┌─────────────────┐
         │                                │ │ drawSquare()    │
         │                                │ └────────┬────────┘
         │                                │          │
         │ Moviendo X: +800              │◀─────────┘
         │◀───────────────────────────────┤
         │                                │
         │                                │ ┌─────────────────┐
         │                                ├→│ moveX(800)      │
         │                                │ └────────┬────────┘
         │                                │          │
         │                                │          ▼
         │                                │   GPIO 12-15
         │                                │     ↓↓↓↓
         │                                │   ULN2003 #1
         │                                │     ↓↓↓↓
         │                                │   Motor X ⚙️
         │                                │
         │ ✓ Cuadrado completado         │
         │◀───────────────────────────────┤
         │                                │


================================================================================
  SISTEMA DE COORDENADAS
================================================================================

                    MAX_Y (4096)
                         ↑
                         │
                         │
         (0, 4096)       │        (4096, 4096)
              ●──────────┼──────────●
              │          │          │
              │          │          │
              │          │          │
              │          │          │
  MAX_X ←─────┼──────────●──────────┼─────→ MAX_X
  (0)         │       (0, 0)        │       (4096)
              │        HOME          │
              │          │          │
              │          │          │
              │          │          │
              │          │          │
              ●──────────┼──────────●
         (0, 0)          │       (4096, 0)
         LÍMITE          ↓       LÍMITE
                      MIN_Y (0)

Rangos válidos:
  X: 0 → 4096 pasos (≈ 80mm)
  Y: 0 → 4096 pasos (≈ 80mm)
  Z: 0 → 512 pasos  (≈ 10mm)


================================================================================
  ALIMENTACIÓN DEL SISTEMA
================================================================================

         ┌──────────────┐
         │   PC/Laptop  │
         └──────┬───────┘
                │ USB-C
         ┌──────▼────────┐           ┌─────────────┐
         │   ESP32 S3    │           │ Fuente 5V   │
         │   (3.3V)      │           │ 2A          │
         │               │           │             │
         │  ┌─────┐      │           └──────┬──────┘
         │  │3.3V │      │                  │
         │  │ LDO │      │                  │ 5V
         └──┴─────┴──────┘                  │
                │                           │
                │ 3.3V                      │ 5V
                ▼                           ▼
         ┌──────────────┐         ┌─────────────────┐
         │   MPU6050    │         │   ULN2003 x3    │
         │   (I2C)      │         │   + Motores     │
         └──────────────┘         └─────────────────┘
            ~5mA                      ~720mA máx

Total de corriente:
  • ESP32 S3: ~200mA
  • MPU6050: ~5mA
  • Motores: ~720mA (3 x 240mA)
  • TOTAL: ~925mA
  
Fuente recomendada: 5V / 2A (con margen)


================================================================================
  FIN DEL DIAGRAMA
================================================================================
